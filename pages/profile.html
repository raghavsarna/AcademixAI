<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AcademixAI - Your Profile</title>
    <link rel="stylesheet" href="/profile.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background">
        <div class="gradient-bg"></div>
        <canvas id="particles-canvas"></canvas>
    </div>
    <header>
        <div class="left">
            <a href="/">
                <img src="/images/logo.png" alt="AcademixAI">
            </a>
        </div>
        <ul>
            <li><a href='/#features-section'>About</a></li>
            <li><a href='/home'>Home</a></li>
            <li><a href='#'>Contact Us</a></li>
        </ul>
        <div class="cta-buttons">
            <button id="logout-btn" class="logout-btn">Logout</button>
        </div>
        <div class="menu-icon" aria-label="Open menu">
            <i class='bx bx-menu'></i>
        </div>
    </header>
    <div class="container">
        <div class="profile-container">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class='bx bxs-user'></i>
                </div>
                <div class="profile-info">
                    <h1>Welcome, <span id="username" class="gradient">User</span></h1>
                    <p id="user-email">user@example.com</p>
                    <p id="member-since">Member since: January 1, 2023</p>
                </div>
            </div>
            
            <div class="profile-tabs">
                <button class="tab-btn active" data-tab="papers">My Papers</button>
                <button class="tab-btn" data-tab="settings">Account Settings</button>
                <button class="tab-btn" data-tab="activity">Recent Activity</button>
            </div>
            
            <div class="tab-content">
                <div id="papers-tab" class="tab-pane active">
                    <h2>Your Uploaded Papers</h2>
                    <div id="user-papers" class="papers-grid">
                        <!-- Papers will be loaded here -->
                        <div class="empty-state">
                            <i class='bx bx-file'></i>
                            <p>You haven't uploaded any papers yet.</p>
                            <a href="/home"><button class="upload-btn-small">Upload a Paper</button></a>
                        </div>
                    </div>
                </div>
                
                <div id="settings-tab" class="tab-pane">
                    <h2>Account Settings</h2>
                    <div class="settings-form">
                        <div class="form-group">
                            <label for="update-email">Email</label>
                            <input type="email" id="update-email" value="user@example.com">
                        </div>
                        <div class="form-group">
                            <label for="update-username">Username</label>
                            <input type="text" id="update-username" value="username">
                        </div>
                        <div class="form-group">
                            <label for="update-password">New Password</label>
                            <input type="password" id="update-password" placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirm Password</label>
                            <input type="password" id="confirm-password" placeholder="Confirm new password">
                        </div>
                        <button class="save-btn">Save Changes</button>
                    </div>
                </div>
                
                <div id="activity-tab" class="tab-pane">
                    <h2>Recent Activity</h2>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon"><i class='bx bx-log-in'></i></div>
                            <div class="activity-details">
                                <p class="activity-title">Account Login</p>
                                <p class="activity-time">Today, 10:30 AM</p>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon"><i class='bx bx-file'></i></div>
                            <div class="activity-details">
                                <p class="activity-title">Viewed Research Paper</p>
                                <p class="activity-desc">Advances in Neural Networks</p>
                                <p class="activity-time">Yesterday, 3:45 PM</p>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon"><i class='bx bx-chat'></i></div>
                            <div class="activity-details">
                                <p class="activity-title">Chat with Paper</p>
                                <p class="activity-desc">Quantum Computing Fundamentals</p>
                                <p class="activity-time">June 15, 2023</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <h1>Copyright © AcademixAI, Made with ❤️ by Raghav Sarna</h1>
    </footer>
    <script>
        // Particles animation
        function initParticles() {
            const canvas = document.getElementById('particles-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            let mouseX = 0;
            let mouseY = 0;

            // Set canvas size
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            // Track mouse position
            document.addEventListener('mousemove', function(e) {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });

            // Create particles
            function createParticles() {
                particles = [];
                const particleCount = Math.floor(window.innerWidth / 10); // Responsive particle count

                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        radius: Math.random() * 2 + 0.5,
                        color: `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.1})`,
                        speedX: Math.random() * 0.5 - 0.25,
                        speedY: Math.random() * 0.5 - 0.25
                    });
                }
            }

            // Draw particles
            function drawParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                particles.forEach(particle => {
                    // Move particles
                    particle.x += particle.speedX;
                    particle.y += particle.speedY;

                    // Wrap around edges
                    if (particle.x < 0) particle.x = canvas.width;
                    if (particle.x > canvas.width) particle.x = 0;
                    if (particle.y < 0) particle.y = canvas.height;
                    if (particle.y > canvas.height) particle.y = 0;

                    // Draw particle
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fillStyle = particle.color;
                    ctx.fill();

                    // Connect particles near mouse
                    const dx = mouseX - particle.x;
                    const dy = mouseY - particle.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < 150) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(255, 255, 255, ${0.2 * (1 - distance/150)})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(particle.x, particle.y);
                        ctx.lineTo(mouseX, mouseY);
                        ctx.stroke();

                        // Slight attraction to mouse
                        particle.x += dx * 0.01;
                        particle.y += dy * 0.01;
                    }

                    // Connect nearby particles
                    particles.forEach(otherParticle => {
                        const dx = particle.x - otherParticle.x;
                        const dy = particle.y - otherParticle.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < 100) {
                            ctx.beginPath();
                            ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - distance/100)})`;
                            ctx.lineWidth = 0.3;
                            ctx.moveTo(particle.x, particle.y);
                            ctx.lineTo(otherParticle.x, otherParticle.y);
                            ctx.stroke();
                        }
                    });
                });
            }

            // Animation loop
            function animate() {
                drawParticles();
                requestAnimationFrame(animate);
            }

            // Initialize
            window.addEventListener('resize', function() {
                resizeCanvas();
                createParticles();
            });

            resizeCanvas();
            createParticles();
            animate();
        }

        // Tab functionality
        function initTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and panes
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanes.forEach(pane => pane.classList.remove('active'));

                    // Add active class to clicked button and corresponding pane
                    button.classList.add('active');
                    const tabId = button.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }

        // Load user data
        async function loadUserData() {
            const token = localStorage.getItem('access_token');
            const tokenType = localStorage.getItem('token_type');
            
            if (!token) {
                // Redirect to login if no token
                window.location.href = '/login';
                return;
            }
            
            try {
                const response = await fetch('/api/users/me', {
                    headers: {
                        'Authorization': `${tokenType} ${token}`
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    
                    // Update UI with user data
                    document.getElementById('username').textContent = userData.username;
                    document.getElementById('user-email').textContent = userData.email;
                    
                    // Format date
                    const createdDate = new Date(userData.created_at);
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    document.getElementById('member-since').textContent = `Member since: ${createdDate.toLocaleDateString('en-US', options)}`;
                    
                    // Update form fields
                    document.getElementById('update-email').value = userData.email;
                    document.getElementById('update-username').value = userData.username;
                    
                    // Load user papers (placeholder for now)
                    // loadUserPapers(userData.id);
                } else {
                    // Token invalid, redirect to login
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('token_type');
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('access_token');
            localStorage.removeItem('token_type');
            window.location.href = '/';
        });

        // Initialize everything when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initParticles();
            initTabs();
            loadUserData();
        });
    </script>
</body>
</html>
